# Настройка изображений в Django проекте

## Что было настроено

### 1. Настройки Django
- Добавлены `MEDIA_URL = '/media/'` и `MEDIA_ROOT = BASE_DIR / 'media'` в `settings.py`
- Настроена обработка медиа файлов в `urls.py` для режима разработки

### 2. Структура папок
```
backend/
├── media/
│   ├── categories/     # Изображения категорий
│   └── products/       # Изображения товаров
├── categories/         # Оригинальные изображения
└── products/          # Оригинальные изображения
```

### 3. Обновленные сериализаторы
- Все сериализаторы теперь правильно возвращают полные URL изображений
- Добавлен метод `get_image()` для корректной обработки изображений
- Передача контекста `request` для построения абсолютных URL

### 4. Настройка views
- Добавлен `get_serializer_context()` в `CategoryViewSet` для передачи request

## Форматы изображений

### Поддерживаемые форматы:
- **JPEG (.jpg, .jpeg)** - рекомендуется для фотографий
- **PNG (.png)** - для изображений с прозрачностью
- **GIF (.gif)** - для анимированных изображений
- **WebP (.webp)** - современный формат

### Рекомендуемые размеры:
- **Категории**: 300x300px
- **Товары**: 800x600px или 1024x768px
- **Максимальный размер файла**: 2-5 МБ

## Как добавить новые изображения

### 1. Через Django Admin
- Зайдите в админку Django (`/admin/`)
- Отредактируйте товар или категорию
- Загрузите изображение в поле "Изображение"

### 2. Программно
```python
from django.core.files import File

# Для товара
product = Product.objects.get(name='Название товара')
with open('path/to/image.jpg', 'rb') as f:
    product.image.save('image.jpg', File(f), save=True)

# Для категории
category = Category.objects.get(name='Название категории')
with open('path/to/image.jpg', 'rb') as f):
    category.image.save('image.jpg', File(f), save=True)
```

### 3. Через скрипт
```bash
python add_images.py
```

## Проверка работы

### 1. Тест API
```bash
python test_api.py
```

### 2. Тест изображений в базе
```bash
python test_images.py
```

### 3. Тест в браузере
Откройте `test_images.html` в браузере для визуальной проверки

## URL изображений

### Формат URL:
- **Категории**: `http://localhost:8000/media/categories/filename.jpg`
- **Товары**: `http://localhost:8000/media/products/filename.jpg`

### В API ответах:
```json
{
  "id": 1,
  "name": "Название товара",
  "image": "http://localhost:8000/media/products/image.jpg"
}
```

## Возможные проблемы

### 1. Изображения не отображаются
- Проверьте, что папка `media/` существует
- Убедитесь, что `MEDIA_URL` и `MEDIA_ROOT` настроены правильно
- Проверьте права доступа к папке `media/`

### 2. Ошибки 404 для изображений
- Убедитесь, что в `urls.py` добавлена обработка медиа файлов
- Проверьте, что `DEBUG = True` в настройках

### 3. Проблемы с кодировкой имен файлов
- Django автоматически обрабатывает кириллические символы
- Используйте латинские названия файлов для лучшей совместимости

## Для продакшена

### 1. Настройка веб-сервера
```nginx
# Nginx
location /media/ {
    alias /path/to/your/media/;
}
```

### 2. CDN
- Рассмотрите использование CDN для статических файлов
- Настройте `STATIC_URL` и `MEDIA_URL` для CDN

### 3. Безопасность
- Ограничьте типы загружаемых файлов
- Добавьте валидацию размеров изображений
- Настройте права доступа к папке `media/`
